<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hare Apparent Offspring Rabbit Calculator ğŸª„</title>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- ğŸ¨ FONT IMPORTS & BASE STYLES -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<link href="https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* âœ¨ BASE PAGE STYLING */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body {
  margin: 0;
  padding: 0;
  font-family: "Cardo", serif;
  background: radial-gradient(circle at 40% 20%, #eaf5ff 0%, #b7d8f2 35%, #fbe49c 90%);
  color: #1b1d25;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 40px 0;
}
.card {
  position: relative;
  background: linear-gradient(180deg, rgba(255,255,255,0.97), rgba(247,245,236,0.98));
  border: 4px solid #d8b552;
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(27,102,170,0.45), inset 0 0 12px rgba(255,255,255,0.4);
  width: 95%;
  max-width: 680px;
  padding: 30px 20px 40px;
  text-align: center;
  box-sizing: border-box;
}

/* ğŸ“± Mobile optimizations */
@media (max-width: 600px) {
  body {
    padding: 20px 0;
  }
  h1 {
    font-size: 1.6em;
    line-height: 1.2;
  }
  .slider-group label {
    width: 140px;
    font-size: 0.9em;
    text-align: left;
  }
  input[type="number"] {
    width: 55px;
  }
  .explanation {
    font-size: 0.85em;
    padding: 15px 12px;
  }
  .art-row img {
    width: 48%;
  }
}

/* ğŸ”– HEADERS */
h1 {
  font-family: "Uncial Antiqua", serif;
  color: #124e88;
  text-shadow: 0 0 8px rgba(28,105,175,0.5);
  margin: 10px 0 6px;
  font-size: 2.1em;
}
.subtitle {
  font-style: italic;
  font-size: 1.05em;
  color: #725a2e;
  margin-bottom: 20px;
}

/* SECTION HEADINGS */
.section-heading {
  text-align: center;
  font-weight: 700;
  color: #124e88;
  position: relative;
  display: inline-block;
  margin: 16px auto 8px;
  font-size: 1.05em;
}
.section-heading::after {
  content: "";
  display: block;
  height: 2px;
  width: 0%;
  background-color: #d8b552;
  margin: 6px auto 0;
  transition: width 0.4s ease-in-out, opacity 0.4s ease-in-out;
  opacity: 0;
}
.section-heading:hover::after {
  width: 80%;
  opacity: 1;
}

/* ğŸšï¸ INPUT CONTROLS */
.slider-group {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 14px auto;
}
label {
  width: 230px;
  text-align: right;
  font-weight: 700;
  color: #2a1e13;
}
input[type="range"] {
  width: 160px;
  accent-color: #2f80ed;
}
input[type="number"] {
  width: 70px;
  padding: 4px;
  font-size: 1em;
  border-radius: 6px;
  border: 2px solid #d8b552;
  text-align: center;
  background: #fffdf8;
  color: #1b1d25;
}
input[type="number"]:focus {
  outline: none;
  border-color: #4596e6;
  box-shadow: 0 0 8px rgba(69,150,230,0.6);
}

/* ğŸª„ BUTTON */
button {
  margin-top: 20px;
  background: linear-gradient(180deg, #f5e2a5, #e7c75e);
  border: 3px solid #d8b552;
  border-radius: 10px;
  padding: 10px 24px;
  font-family: "Uncial Antiqua", serif;
  font-size: 1.1em;
  color: #124e88;
  text-shadow: 0 0 5px rgba(255,255,255,0.6);
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover {
  background: linear-gradient(180deg, #ffeaa7, #f5d36e);
  box-shadow: 0 0 12px rgba(255,215,150,0.7);
}
button.resolving {
  background: linear-gradient(180deg, #bcd8ff, #78a8f0);
  color: #fff;
  box-shadow: 0 0 18px rgba(60,120,255,0.8);
  pointer-events: none;
}

/* ğŸ“œ RESULT */
#result {
  font-size: 1.7em;
  margin-top: 26px;
  font-weight: bold;
  color: #0f4174;
  text-shadow: 0 0 6px rgba(67,132,185,0.4);
  transition: opacity 0.5s ease-in-out;
}

/* ğŸ§™â€â™‚ï¸ NARRATIVE */
.narrative {
  opacity: 0;
  transform: translateY(-15px);
  transition: all 1s ease;
  background: rgba(255,255,255,0.8);
  border: 3px solid #d8b552;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(27,102,170,0.3);
  padding: 15px 18px;
  margin-top: 20px;
  text-align: left;
}
.show-scroll {
  opacity: 1 !important;
  transform: translateY(0) !important;
  animation: scrollFadeIn 1s ease-out;
}
@keyframes scrollFadeIn {
  0% { opacity: 0; transform: translateY(-20px) scaleY(0.98); }
  60% { opacity: 1; transform: translateY(0) scaleY(1.02); }
  100% { transform: translateY(0) scaleY(1); }
}

/* ğŸŸ¨ STACK UPDATE NOTE & BULLETS */
.stack-update {
  text-align: center;
  font-size: 0.9em;
  font-style: italic;
  color: #124e88;
  margin-top: 8px;
  margin-bottom: -6px;
  font-weight: 600;
}
ul {
  margin: 6px 0 10px 35px;
  padding: 0;
  list-style-type: disc;
  color: #1b1d25;
}
ul li { margin-bottom: 6px; }

/* ğŸ“˜ EXPLANATION BOX */
.explanation {
  font-size: 0.95em;
  color: #2a1e13;
  margin-top: 30px;
  line-height: 1.6em;
  text-align: left;
  background: linear-gradient(180deg, #fffdf8, #fdf6e8);
  border: 3px solid #d8b552;
  border-radius: 16px;
  padding: 20px 22px;
  box-shadow: 0 0 15px rgba(27,102,170,0.2), inset 0 0 10px rgba(0,0,0,0.05);
}
.explanation-title {
  text-align: center;
  font-family: "Uncial Antiqua", serif;
  font-size: 1.3em;
  color: #c79838;
  text-shadow: 0 0 6px rgba(200,150,56,0.5);
  margin-bottom: 12px;
}

/* ğŸ§± STACK VISUALIZATION */
.stack-line {
  background: rgba(255,255,255,0.8);
  border: 2px solid #d8b552;
  border-radius: 10px;
  padding: 8px 12px;
  margin: 10px 0;
  box-shadow: 0 0 8px rgba(27,102,170,0.25);
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 6px;
  flex-direction: row;
  font-family: "Cardo", serif;
  font-size: 0.95em;
}
.stack-box {
  background: linear-gradient(180deg, #fffdf8, #fdf3c8);
  border: 1.5px solid #c9a848;
  border-radius: 6px;
  padding: 4px 8px;
  box-shadow: 0 0 6px rgba(27,102,170,0.2);
  white-space: nowrap;
  font-weight: 700;
}
.stack-arrow { color: #c79838; font-weight: bold; }

/* ğŸ¨ ART & FOOTER */
.art-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 8px;
  margin-top: 25px;
}
.art-row img {
  width: 49%;
  border-radius: 12px;
  border: 2px solid #d8b552;
  box-shadow: 0 0 14px rgba(28,105,175,0.4);
  transition: 0.2s;
}
.art-row img:hover {
  transform: scale(1.03);
  box-shadow: 0 0 20px rgba(255,221,130,0.8);
}
footer {
  margin-top: 22px;
  font-size: 0.9em;
  color: #5b4321;
  font-style: italic;
  text-align: center;
  max-width: 90%;
  margin-left: auto;
  margin-right: auto;
}
</style>
</head>

<body>
<div class="card">
  <h1>Hare Apparent Offspring Rabbit Calculator</h1>
  <p class="subtitle">So you cast a <strong>Hare Apparent</strong> paying its <em>Offspring</em> cost...</p>

  <!-- ğŸ§® INPUTS -->
  <div class="slider-group">
    <label for="H">ğŸ‡ Existing Hare Copies (H):</label>
    <input id="H" type="range" min="0" max="40" value="0" oninput="syncInputs('H')">
    <input id="Hnum" type="number" value="0" oninput="syncSliders('H')" max="40" min="0">
  </div>
  <div class="slider-group">
    <label for="T">âœ¨ Token Doublers (T):</label>
    <input id="T" type="range" min="0" max="20" value="0" oninput="syncInputs('T')">
    <input id="Tnum" type="number" value="0" oninput="syncSliders('T')" max="20" min="0">
  </div>
  <div class="slider-group">
    <label for="O">âšœï¸ Token Triplers (O):</label>
    <input id="O" type="range" min="0" max="5" value="0" oninput="syncInputs('O')">
    <input id="Onum" type="number" value="0" oninput="syncSliders('O')" max="5" min="0">
  </div>
  <div class="slider-group">
    <label for="A">ğŸ” Additional Triggers (A):</label>
    <input id="A" type="range" min="0" max="20" value="0" oninput="syncInputs('A')">
    <input id="Anum" type="number" value="0" oninput="syncSliders('A')" max="20" min="0">
  </div>
  <div class="slider-group">
    <label for="Rnum">ğŸ° Existing Rabbit Tokens (R):</label>
    <input id="Rnum" type="number" value="0" min="0">
  </div>

  <div id="result">Rabbits created: â€”</div>
  <button id="resolveBtn" onclick="resolveStack()">Resolve</button>

  <div id="narrative" class="narrative"></div>

  <div class="explanation" id="mathBox">
    <div class="explanation-title">ğŸ“˜ The Mathematical Breakdown</div>
    <p><strong>H</strong> â€” Number of other <em>Hare Apparents</em> already on the battlefield.</p>
    <p><strong>T</strong> â€” Number of <em>token doublers</em> such as Anointed Procession.</p>
    <p><strong>O</strong> â€” Number of <em>token triplers</em> such as Ojer Taq, Deepest Foundation.</p>
    <p><strong>A</strong> â€” Number of <em>additional trigger</em> effects such as Panharmonicon.</p>
    <p><strong>R</strong> â€” Number of <em>existing Rabbit tokens</em> already on the battlefield.</p>
    <div style="text-align:center;margin:10px 0; font-size:0.88em; overflow-x:auto;">
      $$
      X(H,T,A,O)=
      \left[
        \sum_{n=1}^{A+1}
          \Bigl(
            (3^{O}\cdot2^{T})^{2}
            (H + 3^{O}\cdot2^{T} n)
            (A+1)
          \Bigr)
      \right]
      +
      \Bigl(
        3^{O}\cdot2^{T}
        (H + 3^{O}\cdot2^{T}(A+1))
        (A+1)
      \Bigr)
      $$
    </div>
    <p id="rabbitsPerHare"><strong>Each Hare makes:</strong> 1 Rabbit per Hare it sees.</p>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â• ğŸ¨ ART & FOOTER â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="art-row">
    <img src="./zinnia.jpg" alt="Zinnia, Valleyâ€™s Voice">
    <img src="./Hare.jpg" alt="Hare Apparent">
  </div>
  <div class="art-row">
    <img src="./rabbit.jpg" alt="Rabbit Token">
    <img src="./pan.jpg" alt="Panharmonicon">
  </div>
  <div class="art-row">
    <img src="./proc.jpg" alt="Anointed Procession">    
    <img src="./ojer.jpg" alt="Ojer Taq, Deepest Foundation">
  </div>


  <footer>â€œWhy you getting mad at my 4 vampires â€” you're about to make like 30 rabbits?â€ â€” Cody Rich right before he saw 300 rabbits get created</footer>
</div>

<!-- âš™ï¸ JAVASCRIPT -->
<script>
function X(H,T,A,O){
  let term1=0;
  for(let n=1;n<=A+1;n++)
    term1+=((3**O*2**T)**2)*(H+3**O*2**T*n)*(A+1);
  let term2=(3**O*2**T)*(H+3**O*2**T*(A+1))*(A+1);
  return {term1,term2,total:term1+term2};
}
function syncInputs(id){document.getElementById(id+"num").value=document.getElementById(id).value;}
function syncSliders(id){let s=document.getElementById(id),n=document.getElementById(id+"num");n.value=Math.min(Math.max(parseFloat(n.value),s.min),s.max);s.value=n.value;}
function buildStackDisplay(groups){const keys=Object.keys(groups).filter(k=>groups[k]>0);if(!keys.length)return"";let html='<div class="stack-line">';for(let i=0;i<keys.length;i++){html+=`<div class="stack-box"><strong>${groups[keys[i]]}</strong>Ã— ${keys[i]}</div>`;if(i<keys.length-1)html+='<div class="stack-arrow">â†</div>'; }html+='</div>';return html;}

function resolveStack(){
  const btn=document.getElementById("resolveBtn");
  btn.textContent="Resolving...";btn.classList.add("resolving");

  const H=+document.getElementById('H').value,T=+document.getElementById('T').value,A=+document.getElementById('A').value,O=+document.getElementById('O').value,R=+document.getElementById('Rnum').value||0;
  const {term1,term2,total}=X(H,T,A,O),grand=total+R;
  const perHare=3**O*2**T;

  const resultBox=document.getElementById("result");
  resultBox.style.opacity=0;
  resultBox.innerHTML=`Rabbits created: ${total.toLocaleString()}${R>0?`<br><span style="font-size:1.1em;color:#725a2e;">ğŸ° Total rabbits now: ${grand.toLocaleString()}</span>`:""}`;
  setTimeout(()=>resultBox.style.opacity=1,150);

  document.getElementById("rabbitsPerHare").innerHTML=`<strong>Each Hare makes:</strong> ${perHare} Rabbits per Hare it sees.`;

  let nar=`<p class="section-heading">Starting Conditions:</p>
  <ul>
    <li>Each token you create will create <strong>${perHare}</strong> times as many tokens (<em>3<sup>${O}</sup> Ã— 2<sup>${T}</sup></em>).</li>
    <li>Each Enter the Battlefield trigger will trigger <strong>${A+1}</strong> time${A+1 > 1 ? "s" : ""}.</li>
    <li>You start with <strong>${H}</strong> <em>Hare Apparents</em> and <strong>${R}</strong> Rabbit tokens on the battlefield.</li>
  </ul>`;

  nar+=`<p class="section-heading">You cast a Hare Apparent paying its Offspring cost and it resolves.</p>
  <ul>
    <li>It creates <strong>${A+1}</strong> Make Rabbits and <strong>${A+1}</strong> Offspring trigger${A+1 > 1 ? "s" : ""}, then puts them on the stack.</li>
    <li>You stack the triggers so that all Offspring triggers resolve first, followed by the Make Rabbits triggers.</li>
  </ul>`;
  let stack={"Make Rabbits (Original)":A+1,"Offspring":A+1};
  nar+=buildStackDisplay(stack);

  for (let n = 1; n <= A + 1; n++) {
  stack["Offspring"] -= 1;
  if (stack["Offspring"] <= 0) delete stack["Offspring"];

  const hares = 3 ** O * 2 ** T;
  const trigs = A + 1;
  const totalMake = hares * trigs;
  const totalHares = H + 3 ** O * 2 ** T * n;
  const rabbits = ((3 ** O * 2 ** T) ** 2) * (H + 3 ** O * 2 ** T * n) * (A + 1);
  const key = `Make Rabbits (Offspring #${n})`;

  // ğŸ‡ grammatical helpers
  const hareWord = totalHares === 1 ? "Hare" : "Hares";
  const hareTokenWord = hares === 1 ? "token" : "tokens";
  const rabbitWord = rabbits === 1 ? "Rabbit" : "Rabbits";
  const triggerWord = totalMake === 1 ? "trigger" : "triggers";
  const trigPlural = trigs === 1 ? "" : "s";

  nar += `<p class="section-heading">Offspring Trigger #${n} Resolves</p>
  <ul>
    <li><strong>${hares}</strong> 1/1 white <em>Hare Apparent</em> ${hareTokenWord} ${hares > 1 ? "enter the battlefield simultaneously" : "enters the battlefield"}.</li>
    <li>Each Hare makes <strong>${trigs}</strong> Make Rabbits trigger${trigs === 1 ? "" : "s"}, for <strong>${totalMake}</strong> total Make Rabbits trigger${totalMake === 1 ? "" : "s"} placed on top of the stack.</li>

  </ul>`;

  nar += `<div class="stack-update">â• <strong>${totalMake}</strong>Ã— Make Rabbits (Offspring #${n}) added to the stack</div>`;
  stack[key] = totalMake;
  nar += buildStackDisplay(stack);

  nar += `<p class="section-heading">Make Rabbits (Offspring #${n}) Trigger Resolves</p>
  <ul>
    <li>Each Hare makes <strong>${perHare}</strong> Rabbit${perHare > 1 ? "s" : ""} per Hare it sees.</li>
    <li>Each Hare sees <strong>${totalHares}</strong> ${hareWord} on the battlefield making a total of <strong>${perHare * totalHares}</strong> ${rabbitWord} per trigger of Make Rabbits.</li>
    <li><strong>${totalMake}</strong> total Make Rabbits ${triggerWord} resolve sequentially resulting in <strong>${rabbits.toLocaleString()}</strong> 1/1 white Rabbit token${rabbits > 1 ? "s" : ""}.</li>
  </ul>`;

  delete stack[key];
  nar += buildStackDisplay(stack);
}


// ğŸ FINAL RESOLUTION SECTION
// Calculate total hares after all offspring triggers
const finalHares = H + (3 ** O * 2 ** T) * (A + 1);
const hareWord = finalHares === 1 ? "Hare" : "Hares";
const rabbitWord = (perHare * finalHares) === 1 ? "Rabbit" : "Rabbits";
const triggerWord = (A + 1) === 1 ? "trigger" : "triggers";
const totalExtraRabbits = (A + 1) * perHare * finalHares;

nar += `<p class="section-heading">Final Resolution</p>
<ul>
  <li>After all Offspring ${triggerWord} resolve, the remaining Make Rabbits ${triggerWord} from the original Hare resolve last.</li>
  <li>Each of these ${triggerWord} sees <strong>${finalHares}</strong> ${hareWord} on the battlefield and makes <strong>${perHare * finalHares}</strong> ${rabbitWord} per ${triggerWord.slice(0, -1)}.</li>
  <li>With <strong>${A + 1}</strong> total Make Rabbits ${triggerWord} remaining from the original Hare, that results in <strong>${totalExtraRabbits}</strong> additional 1/1 white Rabbit token${totalExtraRabbits === 1 ? "" : "s"}.</li>
</ul>`;

// âš¡ No stack box display for original â€” skip showing it entirely now

nar += `<p class="section-heading">Final Board State</p>
<ul>
  <li>When the stack fully resolves, you control:</li>
  <ul>
    <li>1 regular 2/2 <em>Hare Apparent</em></li>
    <li><strong>${(A + 1) * (3 ** O * 2 ** T)}</strong> 1/1 <em>Hare Apparent</em> token${(A + 1) * (3 ** O * 2 ** T) > 1 ? "s" : ""}</li>
    <li><strong>${total.toLocaleString()}</strong> 1/1 Rabbit token${total > 1 ? "s" : ""}${R > 0 ? ` (including existing ${R} Rabbit${R === 1 ? "" : "s"} â†’ <strong>${grand.toLocaleString()}</strong> total)` : ""}</li>
  </ul>
</ul>`;



  document.getElementById("narrative").innerHTML=nar;

  // âœ… FIXED ANIMATION + MATHJAX SYNC
  if (window.MathJax && window.MathJax.typesetPromise) {
    window.MathJax.typesetPromise().then(() => {
      const narrativeBox = document.getElementById("narrative");
      narrativeBox.classList.add("show-scroll");
      btn.textContent = "Resolve";
      btn.classList.remove("resolving");
    });
  } else {
    const narrativeBox = document.getElementById("narrative");
    setTimeout(() => narrativeBox.classList.add("show-scroll"), 500);
    setTimeout(() => {
      btn.textContent = "Resolve";
      btn.classList.remove("resolving");
    }, 2200);
  }
}
  
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§© INPUT FOCUS / CLEAR LOGIC
// Automatically clears "0" when focused, restores if left empty
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('input[type="number"]').forEach(input => {
    input.addEventListener("focus", () => {
      if (input.value === "0") input.value = "";
    });
    input.addEventListener("blur", () => {
      if (input.value.trim() === "") input.value = "0";
    });
  });
});
  
</script>

<script>
window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']]},svg:{fontCache:'global'}};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</body>
</html>
