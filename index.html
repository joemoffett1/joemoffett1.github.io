<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hare Apparent Offspring Rabbit Calculator 🪄</title>

<link href="https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&family=Uncial+Antiqua&display=swap" rel="stylesheet">

<style>
/* ✨ BASE PAGE STYLING */
body {
  margin: 0;
  padding: 0;
  font-family: "Cardo", serif;
  background: radial-gradient(circle at 40% 20%, #eaf5ff 0%, #b7d8f2 35%, #fbe49c 90%);
  color: #1b1d25;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 40px 0;
}

.card {
  position: relative;
  background: linear-gradient(180deg, rgba(255,255,255,0.97), rgba(247,245,236,0.98));
  border: 4px solid #d8b552;
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(27,102,170,0.45), inset 0 0 12px rgba(255,255,255,0.4);
  width: 680px;
  padding: 35px 40px 45px;
  text-align: center;
}

/* 🔖 HEADERS */
h1 {
  font-family: "Uncial Antiqua", serif;
  color: #124e88;
  text-shadow: 0 0 8px rgba(28,105,175,0.5);
  margin: 10px 0 6px;
  font-size: 2.1em;
}

.subtitle {
  font-style: italic;
  font-size: 1.05em;
  color: #725a2e;
  margin-bottom: 20px;
}

/* 🎚️ SLIDERS & NUMBER BOXES */
.slider-group {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 14px auto;
}
label {
  width: 230px;
  text-align: right;
  font-weight: 700;
  color: #2a1e13;
}
input[type="range"] {
  width: 160px;
  accent-color: #2f80ed;
}
input[type="number"] {
  width: 70px;
  padding: 4px;
  font-size: 1em;
  border-radius: 6px;
  border: 2px solid #d8b552;
  text-align: center;
  background: #fffdf8;
  color: #1b1d25;
}
input[type="number"]:focus {
  outline: none;
  border-color: #4596e6;
  box-shadow: 0 0 8px rgba(69,150,230,0.6);
}

/* 🪄 RESOLVE BUTTON */
button {
  margin-top: 20px;
  background: linear-gradient(180deg, #f5e2a5, #e7c75e);
  border: 3px solid #d8b552;
  border-radius: 10px;
  padding: 10px 24px;
  font-family: "Uncial Antiqua", serif;
  font-size: 1.1em;
  color: #124e88;
  text-shadow: 0 0 5px rgba(255,255,255,0.6);
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover {
  background: linear-gradient(180deg, #ffeaa7, #f5d36e);
  box-shadow: 0 0 12px rgba(255,215,150,0.7);
}
button.resolving {
  background: linear-gradient(180deg, #bcd8ff, #78a8f0);
  color: #fff;
  box-shadow: 0 0 18px rgba(60,120,255,0.8);
  pointer-events: none;
}

/* 📜 RESULT TEXT */
#result {
  font-size: 1.7em;
  margin-top: 26px;
  font-weight: bold;
  color: #0f4174;
  text-shadow: 0 0 6px rgba(67,132,185,0.4);
}

/* 🧙‍♂️ ANIMATIONS */
.narrative, .math-breakdown {
  opacity: 0;
  transform: translateY(-15px);
  transition: all 1s ease;
  background: rgba(255,255,255,0.8);
  border: 3px solid #d8b552;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(27,102,170,0.3);
  padding: 15px 18px;
  margin-top: 20px;
  text-align: left;
}
.show-scroll {
  opacity: 1 !important;
  transform: translateY(0) !important;
  animation: scrollFadeIn 1s ease-out;
}
@keyframes scrollFadeIn {
  0% { opacity: 0; transform: translateY(-20px) scaleY(0.98); }
  60% { opacity: 1; transform: translateY(0) scaleY(1.02); }
  100% { transform: translateY(0) scaleY(1); }
}
.text-reveal {
  opacity: 1 !important;
  animation: textReveal 1.4s ease-in-out;
}
@keyframes textReveal {
  0% { opacity: 0; filter: blur(3px); }
  100% { opacity: 1; filter: blur(0); }
}

/* 📘 Unified Explanation Box */
.explanation {
  font-size: 0.95em;
  color: #2a1e13;
  margin-top: 30px;
  line-height: 1.6em;
  text-align: left;
  background: linear-gradient(180deg, #fffdf8, #fdf6e8);
  border: 3px solid #d8b552;
  border-radius: 16px;
  padding: 20px 22px;
  box-shadow: 0 0 15px rgba(27,102,170,0.2), inset 0 0 10px rgba(0,0,0,0.05);
}
.explanation-title {
  text-align: center;
  font-family: "Uncial Antiqua", serif;
  font-size: 1.3em;
  color: #c79838;
  text-shadow: 0 0 6px rgba(200,150,56,0.5);
  margin-bottom: 12px;
}

/* 🎨 ART & FOOTER */
.art-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 8px;
  margin-top: 25px;
}
.art-row img {
  width: 49%;
  border-radius: 12px;
  border: 2px solid #d8b552;
  box-shadow: 0 0 14px rgba(28,105,175,0.4);
  transition: 0.2s;
}
.art-row img:hover {
  transform: scale(1.03);
  box-shadow: 0 0 20px rgba(255,221,130,0.8);
}
footer {
  margin-top: 22px;
  font-size: 0.9em;
  color: #5b4321;
  font-style: italic;
  text-align: center;
  max-width: 90%;
  margin-left: auto;
  margin-right: auto;
}
</style>
</head>

<body>
<div class="card">
  <h1>Hare Apparent Offspring Rabbit Calculator</h1>
  <p class="subtitle">So you cast a <strong>Hare Apparent</strong> paying its <em>Offspring</em> cost...</p>

  <!-- 🎚️ Input Controls -->
  <div class="slider-group">
    <label for="H">🐇 Existing Hare Copies (H):</label>
    <input id="H" type="range" min="0" max="40" value="0" oninput="syncInputs('H')">
    <input id="Hnum" type="number" value="0" oninput="syncSliders('H')" max="40" min="0">
  </div>
  <div class="slider-group">
    <label for="T">✨ Token Doublers (T):</label>
    <input id="T" type="range" min="0" max="20" value="0" oninput="syncInputs('T')">
    <input id="Tnum" type="number" value="0" oninput="syncSliders('T')" max="20" min="0">
  </div>
  <div class="slider-group">
    <label for="A">🔁 Additional Triggers (A):</label>
    <input id="A" type="range" min="0" max="20" value="0" oninput="syncInputs('A')">
    <input id="Anum" type="number" value="0" oninput="syncSliders('A')" max="20" min="0">
  </div>
  <div class="slider-group">
    <label for="Rnum">🐰 Existing Rabbit Tokens (R):</label>
    <input id="Rnum" type="number" value="0" min="0">
  </div>

  <div id="result">Rabbits created: —</div>
  <button id="resolveBtn" onclick="resolveStack()">Resolve</button>

  <div id="narrative" class="narrative"></div>

  <div class="explanation">
    <div class="explanation-title">📘 The Mathematical Breakdown</div>
    <p><strong>H</strong> — Number of other <em>Hare Apparents</em> already on the battlefield.</p>
    <p><strong>T</strong> — Number of <em>token doublers</em> such as Anointed Procession.</p>
    <p><strong>A</strong> — Number of <em>additional trigger</em> effects such as Panharmonicon.</p>
    <p><strong>R</strong> — Number of <em>existing Rabbit tokens</em> already on the battlefield.</p>

    <div class="formula" style="text-align:center; margin:10px 0;">
      $$
      X(H,T,A)=\Biggl\lbrace
      \Biggl(
      \sum_{n=1}^{A+1}
      \left(2^{T}\right)^{2}\cdot
      \bigl(H+2^{T}n\bigr)\cdot(A+1)
      \Biggr)
      +
      \Bigl(
      2^{T}\cdot
      \bigl(H+2^{T}(A+1)\bigr)\cdot(A+1)
      \Bigr)
      \Biggr\rbrace
      $$
    </div>
    <div id="mathBreakdown"></div>
  </div>

<div class="art-row">
  <img src="./zinnia.jpg" alt="Zinnia, Valley’s Voice">
  <img src="./Hare.jpg" alt="Hare Apparent">
</div>

<!-- 🌟 New Art Row: Token Doublers & Trigger Enhancers -->
<div class="art-row">
  <img src="./proc.jpg" alt="Anointed Procession">
  <img src="./pan.jpg" alt="Panharmonicon">
</div>

  <footer>“Why you getting mad at my 4 vampires — you're about to make like 30 rabbits?” — Cody Rich right before he saw 300 rabbits get created </footer>
</div>

<script>
function X(H,T,A){
  let term1=0;
  for(let n=1;n<=A+1;n++){term1+=(2**T)**2*(H+2**T*n)*(A+1);}
  let term2=(2**T)*(H+2**T*(A+1))*(A+1);
  return{term1,term2,total:term1+term2};
}
function syncInputs(id){const s=document.getElementById(id),n=document.getElementById(id+"num");n.value=s.value;}
function syncSliders(id){const s=document.getElementById(id),n=document.getElementById(id+"num");let v=parseFloat(n.value);if(v>parseFloat(s.max))v=parseFloat(s.max);if(v<parseFloat(s.min))v=parseFloat(s.min);n.value=v;s.value=v;}

function resolveStack(){
  const btn=document.getElementById("resolveBtn");
  btn.textContent="Resolving...";btn.classList.add("resolving");

  const H=parseFloat(document.getElementById('H').value);
  const T=parseFloat(document.getElementById('T').value);
  const A=parseFloat(document.getElementById('A').value);
  const R=parseFloat(document.getElementById('Rnum').value)||0;

  const {term1,term2,total}=X(H,T,A);
  const grandTotal=total+R;

  let resultHTML=`Rabbits created: ${total.toLocaleString()}`;
  if(R>0){
    resultHTML+=`<br><span style="font-size:1.1em;color:#725a2e;">🐰 Total 1/1 rabbit tokens: ${grandTotal.toLocaleString()}</span>`;
  }
  document.getElementById('result').innerHTML=resultHTML;

  let nar=`<div class='narrative-title'>🪄 Stack Resolution Log</div>`;
  for(let n=1;n<=A+1;n++){
    const hC=2**T;
    const seen=H+2**T*n;
    const trig=A+1;
    const rabbits=hC*seen*(2**T)*(A+1);
    nar+=`<p>🪄 <strong>Offspring Trigger #${n}</strong> resolves.<br>
    ${hC} new <strong>1/1 white Hare Apparent token${hC>1?'s':''}</strong> appear, seeing ${seen} total Hares.<br>
    Their “Make Rabbits” triggers fire ${trig} times.<br>
    → <strong>${rabbits}</strong> <em>1/1 white Rabbit token${rabbits>1?'s':''}</em> are created.</p>`;
  }

  const final=(2**T)*(H+2**T*(A+1))*(A+1);
  nar+=`<p>🪄 <strong>Original Hare’s “Make Rabbits”</strong> resolves last.<br>
  It sees ${H+2**T*(A+1)} total Hares and triggers ${A+1} times.<br>
  → <strong>${final}</strong> <em>1/1 white Rabbit token${final>1?'s':''}</em> are created.</p>
  <p><strong>✨ Summary:</strong><br>
  1 <strong>2/2 Hare Apparent</strong>, ${(A+1)*(2**T)} <strong>1/1 Hare Apparent token${(A+1)*(2**T)>1?'s':''}</strong>, and ${total} <strong>1/1 Rabbit token${total>1?'s':''}</strong> enter the battlefield.<br>
  ${R>0?`Including existing ${R} Rabbits → <strong>${grandTotal}</strong> total Rabbits.`:''}</p>`;
  document.getElementById("narrative").innerHTML=nar;

  // 🧮 Build math breakdown (same as before)
  let math=`<div class='breakdown-intro'>Calculation Breakdown:</div>`;
  math+=`$$\\text{Given: } H=${H},\\ T=${T},\\ A=${A},\\ R=${R}$$`;
  math+=`$$\\text{Term}_1 = \\sum_{n=1}^{${A+1}} (2^{${T}})^2(H+2^{${T}}n)(A+1)$$`;
  let offspringSum=0;
  for(let n=1;n<=A+1;n++){
    const termValue=((2**T)**2)*(H+2**T*n)*(A+1);
    offspringSum+=termValue;
    math+=`
    $$\\textbf{Offspring Trigger } n=${n}: = ${termValue.toLocaleString()}$$`;
  }
  const hareTerm=(2**T)*(H+2**T*(A+1))*(A+1);
  const totalSum=offspringSum+hareTerm;
  math+=`
  $$\\textbf{Sum of Offspring Triggers: } ${offspringSum.toLocaleString()}$$
  $$\\textbf{Original Hare Term: } = ${hareTerm.toLocaleString()}$$
  $$X(${H},${T},${A})=${totalSum.toLocaleString()}$$`;
  if(R>0){
    math+=`
    $$\\textbf{Existing Rabbits (R): } ${R.toLocaleString()}$$
    $$\\textbf{Final Total Rabbits: } X+R = ${totalSum.toLocaleString()} + ${R.toLocaleString()} = ${grandTotal.toLocaleString()}$$`;
  }

  document.getElementById("mathBreakdown").innerHTML=math;

  setTimeout(()=>{document.getElementById("narrative").classList.add("show-scroll");},500);
  setTimeout(()=>{
    document.getElementById("mathBreakdown").classList.add("text-reveal");
    if(window.MathJax)MathJax.typesetPromise();
  },1100);
  setTimeout(()=>{btn.textContent="Resolve";btn.classList.remove("resolving");},2200);
}
</script>

<script>
window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:true},svg:{fontCache:'global'}};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</body>
</html>
